[{"id":"d7eda565344d3004","type":"tab","label":"Deconz","disabled":false,"info":""},{"id":"e8fabf2a01eed782","type":"tab","label":"Workshop","disabled":false,"info":""},{"id":"df36b737c8742674","type":"tab","label":"Global","disabled":false,"info":""},{"id":"f7d3139e6c4a4f09","type":"tab","label":"Kitchen","disabled":false,"info":""},{"id":"51491686703cf8dc","type":"tab","label":"Lounge","disabled":false,"info":""},{"id":"e843e6ebd1213758","type":"tab","label":"House","disabled":false,"info":"","env":[]},{"id":"2e5742b3e3e96e77","type":"subflow","name":"Subflow 1","info":"","in":[{"x":280,"y":160,"wires":[{"id":"2aebf76ca4d26616"}]}],"out":[]},{"id":"459a3cbe0129c6cb","type":"subflow","name":"Cube","info":"msg.event = \"Slide, Flip, 180 Flip, Double tap, Drop\"\nmsg.side","category":"","in":[{"x":60,"y":40,"wires":[{"id":"aa16b7bc3e010baf"}]}],"out":[{"x":760,"y":100,"wires":[{"id":"64f4fde9660a66b9","port":0}]},{"x":760,"y":260,"wires":[{"id":"aa16b7bc3e010baf","port":0}]}],"env":[]},{"id":"8efa479ae1bac524","type":"subflow","name":"Vibration Sensor","info":"","category":"","in":[{"x":50,"y":30,"wires":[{"id":"7f1b62338882aff8"}]}],"out":[{"x":800,"y":60,"wires":[{"id":"539bdb49a2b002b5","port":0}]},{"x":820,"y":180,"wires":[{"id":"a07799b0284b0b65","port":1}]}],"env":[]},{"id":"c0604ab0c1a08417","type":"subflow","name":"Bedroom Lights","info":"","category":"","in":[{"x":50,"y":30,"wires":[{"id":"275cf546e4a89352"},{"id":"c44e4baccaa05d19"},{"id":"bc294950addddfbe"}]}],"out":[{"x":560,"y":80,"wires":[{"id":"275cf546e4a89352","port":0},{"id":"c44e4baccaa05d19","port":0},{"id":"bc294950addddfbe","port":0}]}],"env":[]},{"id":"0c4a1aef5ced3d40","type":"subflow","name":"Toggle SMTSKT State w/ timeouts","info":"","category":"","in":[{"x":60,"y":120,"wires":[{"id":"7ccfaa96cd378cc4"}]}],"out":[{"x":740,"y":120,"wires":[{"id":"b9a986b82af4bec6","port":0}]}],"env":[{"name":"event_name","type":"str","value":"not supplied","ui":{"type":"input","opts":{"types":["str","env"]}}},{"name":"variation","type":"str","value":"20 minutes"},{"name":"timeout_seconds","type":"num","value":"10"}],"meta":{},"color":"#DDAA99","status":{"x":620,"y":260,"wires":[{"id":"b9a986b82af4bec6","port":1}]}},{"id":"5609c5c8e8bb268b","type":"subflow","name":"Since Last Read","info":"","category":"","in":[{"x":60,"y":80,"wires":[{"id":"1a991aa2a1f77e0a"}]}],"out":[{"x":420,"y":80,"wires":[{"id":"1a991aa2a1f77e0a","port":0}]}],"env":[],"meta":{},"color":"#DDAA99"},{"id":"0e02cff517febd41","type":"subflow","name":"Min or Max","info":"","category":"","in":[{"x":60,"y":80,"wires":[{"id":"2043d08596d03e60"}]}],"out":[{"x":340,"y":80,"wires":[{"id":"2043d08596d03e60","port":0}]}],"env":[{"name":"MinOrMax","type":"str","value":"MIN","ui":{"icon":"font-awesome/fa-bars","type":"select","opts":{"opts":[{"l":{"en-US":"Min"},"v":"MIN"},{"l":{"en-US":"Max"},"v":"MAX"}]}}}],"meta":{},"color":"#DDAA99"},{"id":"cda9d340ce49a5bf","type":"group","z":"d7eda565344d3004","name":"","style":{"fill":"#ffefbf","fill-opacity":"0.5","label":true},"nodes":["7fcf85ed2b79915e","6c585d81f6912a31","898cc3fad12c9c7b","e93986f662f386c4"],"x":874,"y":239,"w":422,"h":122},{"id":"358a9b518d2b53b9","type":"group","z":"e843e6ebd1213758","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["f3a488a10df14177","7d8bb5e5c5533500","2396beb836cddc6f","c11a777ce0542960","7946d3da9852fcc2","6a02542369982caf","baee0946b13e1f01"],"x":414,"y":439,"w":812,"h":162},{"id":"2f5d97db8e632bd6","type":"group","z":"e843e6ebd1213758","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["7f4dd7a1cccfa4e9","1af66367dce8e76c","a39377a4dc58c568","d00cfc3717188882","7ca4416498fe6d73","d485cc3de8136ecd","bfb9378b444b06ab"],"x":414,"y":659,"w":812,"h":162},{"id":"e80b953f1a14d2de","type":"group","z":"e843e6ebd1213758","name":"Bedroom Fan","style":{"fill":"#bfdbef","label":true},"nodes":["d15733b76b3778fb","b473861c92bd5f10","a37aeae2b9ee3068","03ed68b181f0d091","1d51ae3ced88d779","0e76c9f0ce26c6e6"],"x":414,"y":39,"w":992,"h":162},{"id":"627df8f806a8df74","type":"mqtt-broker","name":"MQTT","broker":"192.168.1.105","port":"1883","clientid":"","autoConnect":true,"usetls":false,"protocolVersion":4,"keepalive":"60","cleansession":true,"autoUnsubscribe":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"459b291cbb78de2a","type":"websocket-listener","path":"ws://192.168.1.105:8088","wholemsg":"false"},{"id":"3b9d43dd3e715cfb","type":"websocket-client","path":"ws://192.168.1.105:443","tls":"","wholemsg":"false"},{"id":"21fb2522880514a3","type":"websocket-listener","path":"http://192.168.1.105:80/api/E09E33DE20/lights","wholemsg":"false"},{"id":"665ec66d99d25354","type":"ui_base","name":"","theme":{"name":"theme-dark","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#097479","value":"#097479","edited":false},"page-titlebar-backgroundColor":{"value":"#097479","edited":false},"page-backgroundColor":{"value":"#111111","edited":false},"page-sidebar-backgroundColor":{"value":"#000000","edited":false},"group-textColor":{"value":"#0eb8c0","edited":false},"group-borderColor":{"value":"#555555","edited":false},"group-backgroundColor":{"value":"#333333","edited":false},"widget-textColor":{"value":"#eeeeee","edited":false},"widget-backgroundColor":{"value":"#097479","edited":false},"widget-borderColor":{"value":"#333333","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"26b1a7bef225fddf","type":"xterm_config","rows":60,"columns":120,"cursorStyle":"bar","fastScrollModifier":"alt","scrollSensitivity":1,"fastScrollSensitivity":1,"scrollback":1000,"backgroundColor":"#000000","foregroundColor":"#ffffff","fontSize":14,"cursorBlink":true,"drawBoldTextInBrightColors":true,"loggingEnabled":false,"name":""},{"id":"24720c3b.ea60e4","type":"mqtt-broker","name":"","broker":"localhost","port":"1883","clientid":"","usetls":false,"protocolVersion":"4","keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","birthMsg":{},"closeTopic":"","closeQos":"0","closePayload":"","closeMsg":{},"willTopic":"","willQos":"0","willPayload":"","willMsg":{},"sessionExpiry":""},{"id":"66618e35.02598","type":"ui_tab","name":"Aqara Sensors","icon":"dashboard","disabled":false,"hidden":false},{"id":"2f0002313b6e6042","type":"ui_group","name":"Bedroom","tab":"66618e35.02598","order":1,"disp":true,"width":"6","collapse":false},{"id":"cb532fdebf14059e","type":"ui_group","name":"Lights","tab":"66618e35.02598","order":4,"disp":true,"width":"8","collapse":false},{"id":"95141f0ee55e0d3e","type":"ui_group","name":"Lounge","tab":"66618e35.02598","order":2,"disp":true,"width":"6","collapse":false},{"id":"c55d435f77e60733","type":"ui_group","name":"Outside","tab":"66618e35.02598","order":3,"disp":true,"width":"6","collapse":false},{"id":"a2d93ff3dc576ecd","type":"ui_group","name":"Workshop","tab":"66618e35.02598","order":5,"disp":true,"width":"6","collapse":false},{"id":"2aebf76ca4d26616","type":"function","z":"2e5742b3e3e96e77","name":"RELAY_ON","func":"var smtskt2sstate=flow.get('smtskt2sstate') || 0;\n\nif (smtskt2sstate === 0) {\n    msg.payload = \"$RELAY$ON\";\n    flow.set('smtskt2sstate', 1);\n}\nelse {\n    msg.payload = \"$RELAY$OFF\";\n    flow.set('smtskt2sstate', 0);\n}\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":160,"wires":[[]]},{"id":"3cd4f092127a5433","type":"switch","z":"459a3cbe0129c6cb","name":"Cube","property":"payload.id","propertyType":"msg","rules":[{"t":"eq","v":"2","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":350,"y":140,"wires":[["64f4fde9660a66b9"],[]]},{"id":"64f4fde9660a66b9","type":"function","z":"459a3cbe0129c6cb","name":"Event (.event, .side)","func":"\nif (msg.payload.state === undefined || \n    msg.payload.state.buttonevent === undefined) {\n    return null;\n}\n\nvar event = msg.payload.state.buttonevent;\nvar side = Math.round(event/1000);\nvar modifier = event - (side * 1000);\nmsg.side = side;\n\nif (event % 1000 === 0) {\n    msg.event = \"slide\";\n}\nelse if (event === 7007) {\n    msg.event = \"shake\";\n}\nelse if (event === (side*1000) + side) {\n    msg.event = \"doubletap\";\n}\nelse if (side + modifier === 7) {\n    msg.event = \"180flip\";\n}\nelse if (side != 7 - modifier) {\n    msg.event = \"flip\";\n}\nelse if (event === 7008) {\n    msg.event = \"drop\";\n}\nelse {\n    msg.event = \"unknown (\" + event + \")\";\n}\nreturn msg;","outputs":1,"noerr":0,"x":560,"y":100,"wires":[[]]},{"id":"aa16b7bc3e010baf","type":"json","z":"459a3cbe0129c6cb","name":"","property":"payload","action":"","pretty":false,"x":210,"y":260,"wires":[["3cd4f092127a5433"]]},{"id":"2038760293478666","type":"comment","z":"459a3cbe0129c6cb","name":"Links","info":"http://blog.smarterhome.club/2019/04/30/raspbee4/","x":470,"y":220,"wires":[]},{"id":"a07799b0284b0b65","type":"switch","z":"8efa479ae1bac524","name":"Vibration","property":"payload.id","propertyType":"msg","rules":[{"t":"eq","v":"9","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":360,"y":100,"wires":[["539bdb49a2b002b5"],[]]},{"id":"539bdb49a2b002b5","type":"function","z":"8efa479ae1bac524","name":"msg.strength","func":"if (msg.payload.state === undefined ||\n    msg.payload.state.vibration === undefined) {\n    return null;        \n}\n\nif (msg.payload.state.vibration === true) {\n    msg.strength = msg.payload.state.strength;\n    return msg;\n}\nreturn null;","outputs":1,"noerr":0,"x":530,"y":60,"wires":[[]]},{"id":"7f1b62338882aff8","type":"json","z":"8efa479ae1bac524","name":"","property":"payload","action":"","pretty":false,"x":210,"y":220,"wires":[["a07799b0284b0b65"]]},{"id":"4bc340c61fe59a48","type":"comment","z":"8efa479ae1bac524","name":"Links","info":"http://blog.smarterhome.club/2019/04/30/raspbee4/","x":470,"y":180,"wires":[]},{"id":"275cf546e4a89352","type":"http request","z":"c0604ab0c1a08417","name":"Light 1 State","method":"PUT","ret":"obj","paytoqs":false,"url":"http://192.168.1.105:80/api/7665109987/lights/4/state","tls":"","proxy":"","authType":"","x":310,"y":100,"wires":[[]]},{"id":"c44e4baccaa05d19","type":"http request","z":"c0604ab0c1a08417","name":"Light 2 State","method":"PUT","ret":"obj","paytoqs":false,"url":"http://192.168.1.105:80/api/7665109987/lights/5/state","tls":"","proxy":"","authType":"","x":310,"y":160,"wires":[[]]},{"id":"bc294950addddfbe","type":"http request","z":"c0604ab0c1a08417","name":"Light 3 State","method":"PUT","ret":"obj","paytoqs":false,"url":"http://192.168.1.105:80/api/7665109987/lights/6/state","tls":"","proxy":"","authType":"","x":310,"y":220,"wires":[[]]},{"id":"7ccfaa96cd378cc4","type":"function","z":"0c4a1aef5ced3d40","name":"","func":"var event_name = env.get(\"event_name\");\nvar timeout_seconds = env.get(\"timeout_seconds\");\nvar last_payload = context.get(event_name) || \"off\";\n\n// node.warn(event_name);\n\nvar payload = {\n    payload: \"on\",\n    timeout: timeout_seconds\n};\n\nvar is_plug_button = msg.payload \n    == \"EV_SPECFIC_TIME_REACHED\" || msg.payload \n    == \"EV_CLICKED\";\nvar is_motion = msg.payload.state != null &&\n    msg.payload.state.presence != null;\nvar is_deconz_button = msg.payload.state != null &&\n    msg.payload.state.buttonevent != null &&\n    msg.payload.state.buttonevent == \"1002\";\n\n// toggle\nif (is_plug_button || is_deconz_button || msg.payload == \"on\") {\n    payload.payload = last_payload == \"off\" ? \"on\" : \"off\";\n}\n// retrigger\nelse if (is_motion) {\n    payload.payload = \"on\";\n}\nelse {\n    return;\n}\n\ncontext.set(event_name, payload.payload); // store new payload state\n\nmsg.payload = payload;\n// node.warn(msg.payload);\n    \nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":220,"y":120,"wires":[["b9a986b82af4bec6"]]},{"id":"b9a986b82af4bec6","type":"mytimeout","z":"0c4a1aef5ced3d40","name":"","outtopic":"","outsafe":"$LED$ON$RELAY$ON","outwarning":"","outunsafe":"$LED$OFF$RELAY$OFF","warning":"0","timer":"10800","debug":false,"ndebug":false,"ignoreCase":false,"repeat":false,"again":false,"x":430,"y":120,"wires":[[],[]]},{"id":"1a991aa2a1f77e0a","type":"function","z":"5609c5c8e8bb268b","name":"Since last temp read","func":"var lastTempTime = context.get(\"lastTempTime\" + node.id) || 0;\nvar lastTimestamp = context.get(\"lastTimestamp\") || 0;\n\nlet loungeTime = new Date(lastTempTime);\nlet timestamp = new Date(lastTimestamp);\n\n// is temperature\nif (msg.payload.state?.temperature != null) {\n  context.set(\"lastTempTime\" + node.id, msg.payload.state.lastupdated); // to store a variable\n    return null;\n}\nelse {\n    // timestamp\n    context.set(\"lastTimestamp\", msg.payload);\n    timestamp = new Date(msg.payload);\n}\n\nif (lastTempTime == 0) {\n  msg.sincelast = \"-1\";\n  msg.timestamp = timestamp;\n\n}\nelse {\n  if (loungeTime > timestamp)\n    loungeTime.setDate(loungeTime.getDate() + 1);\n\n  msg.sincelast = (Date.parse(timestamp) - Date.parse(loungeTime))/1000;\n  msg.timestamp = timestamp;\n  msg.loungeTime = loungeTime;\n}\n\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":240,"y":80,"wires":[[]],"icon":"node-red-contrib-mytimeout/stopwatch.png"},{"id":"2043d08596d03e60","type":"function","z":"0e02cff517febd41","name":"Min Max","func":"\nvar isMax = env.get(\"MinOrMax\") == \"MAX\";\nconst todaysLimitTempKey = isMax \n  ? \"todaysMaxTemp\" + node.id \n  : \"todaysMinTemp\" + node.id;\nconst otherLimitTempKey = isMax \n  ? \"todaysMinTemp\" + node.id \n  : \"todaysMaxTemp\" + node.id;\nconst defaultValue = isMax ? 0.0 : 99.9;\n\nvar todaysLimitTemp = context.get(todaysLimitTempKey) || {\n    value: defaultValue,\n    time: msg.lastupdated\n};\nvar otherLimitTemp = context.get(otherLimitTempKey) || {\n    value: defaultValue,\n    time: msg.lastupdated\n};\n\nif (isMax) {\n  msg.max = todaysLimitTemp;\n  msg.min = otherLimitTemp;\n}\nelse {\n  msg.max = otherLimitTemp;\n  msg.min = todaysLimitTemp;\n}\n\nvar isSameDay = new Date(todaysLimitTemp.time).getDate()\n            == new Date(msg.lastupdated).getDate();\n\nif (!isSameDay) {\n  node.warn(todaysLimitTemp.time + \" \" + new Date(todaysLimitTemp.time).getDate());\n  node.warn(msg.lastupdated + \" \" + new Date(msg.lastupdated).getDate());\n}\n\nvar isExceeded = isMax ? \n  msg.temperature != null && msg.temperature > todaysLimitTemp.value :\n  msg.temperature != null && msg.temperature < todaysLimitTemp.value;\n\n// node.warn(msg.temperature + \" vs \" + todaysLimitTemp.value);\n\nif (isSameDay) {\n  if (isExceeded) {\n    todaysLimitTemp = {\n      value: msg.temperature,\n      time: msg.lastupdated\n    };\n    context.set(todaysLimitTempKey, todaysLimitTemp);\n\n    if (isMax) {\n      msg.max = todaysLimitTemp;\n      msg.min = otherLimitTemp;\n      node.warn(\"Max updated: \" + msg.temperature);\n    }\n    else {\n      msg.min = todaysLimitTemp;\n      msg.max = otherLimitTemp;\n      node.warn(\"Min updated: \" + msg.temperature);\n    }\n  }\n  else {\n    // node.warn(\"Not exceeded \" + todaysLimitTemp.value);\n  }\n}\nelse {\n  // not the same day, new limit temp!\n  todaysLimitTemp = {\n      value: msg.temperature,\n      time: msg.lastupdated\n    };\n  context.set(todaysLimitTempKey, todaysLimitTemp);\n}\n\nreturn msg;\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":200,"y":80,"wires":[[]]},{"id":"b08fa78050700a6e","type":"websocket in","z":"d7eda565344d3004","name":"","server":"","client":"3b9d43dd3e715cfb","x":140,"y":60,"wires":[["af6617cc9d3975f8","f95d794180f2bcc5"]]},{"id":"baa6ae6283bd2ef6","type":"comment","z":"d7eda565344d3004","name":"https://github.com/dresden-elektronik/deconz-rest-plugin/issues/138#issuecomment-325101635","info":"https://github.com/dresden-elektronik/deconz-rest-plugin/issues/138#issuecomment-325101635","x":330,"y":1000,"wires":[]},{"id":"0b6cf22c9ad0936d","type":"mqtt out","z":"d7eda565344d3004","name":"","topic":"/device/cube1/event","qos":"","retain":"","broker":"627df8f806a8df74","x":1020,"y":600,"wires":[]},{"id":"c95cd9c8b83a0a51","type":"mqtt out","z":"d7eda565344d3004","name":"","topic":"/device/aqara/vibration/door","qos":"","retain":"","broker":"627df8f806a8df74","x":1020,"y":720,"wires":[]},{"id":"af6617cc9d3975f8","type":"json","z":"d7eda565344d3004","name":"","property":"payload","action":"","pretty":false,"x":130,"y":680,"wires":[["c12a5f69e18e59f4","cf3e755026b4ce3e","a506b2a82d2e8cde","4b22abbc48e5cd4c","a209e73e1513e91c","3cc93e1075cf84be","2935353eedd436be","a25943a90d6d2075","baa3308fdde5af99","e723d6a4da0d1d9a"]]},{"id":"c12a5f69e18e59f4","type":"switch","z":"d7eda565344d3004","name":"Cube1","property":"payload.id","propertyType":"msg","rules":[{"t":"eq","v":"9","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":410,"y":600,"wires":[[]]},{"id":"cf3e755026b4ce3e","type":"switch","z":"d7eda565344d3004","name":"Vibration Front Door","property":"payload.id","propertyType":"msg","rules":[{"t":"eq","v":"9","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":460,"y":680,"wires":[["c95cd9c8b83a0a51"]]},{"id":"a506b2a82d2e8cde","type":"switch","z":"d7eda565344d3004","name":"Vibration Other","property":"payload.id","propertyType":"msg","rules":[{"t":"eq","v":"10","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":440,"y":720,"wires":[[],[]]},{"id":"4b22abbc48e5cd4c","type":"switch","z":"d7eda565344d3004","name":"Lights","property":"payload.id","propertyType":"msg","rules":[{"t":"eq","v":"4","vt":"str"},{"t":"eq","v":"5","vt":"str"},{"t":"eq","v":"6","vt":"str"},{"t":"eq","v":"1","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":5,"x":770,"y":1020,"wires":[["082fd05af6526f4f"],["082fd05af6526f4f"],["082fd05af6526f4f"],["082fd05af6526f4f"],["082fd05af6526f4f"]]},{"id":"1a119cb1cfca7871","type":"mqtt out","z":"d7eda565344d3004","name":"","topic":"/device/aqara/motion/kitchen","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"627df8f806a8df74","x":1300,"y":440,"wires":[]},{"id":"1faba91e9e2d7cb4","type":"function","z":"d7eda565344d3004","name":"Kitchen","func":"if (msg.payload.state !== undefined && msg.payload.state.presence) {\n    msg.payload = \"on\";\n    return msg;\n}\nreturn null;","outputs":1,"timeout":"","noerr":0,"initialize":"","finalize":"","libs":[],"x":780,"y":440,"wires":[["9edb78db7e784d02","1a119cb1cfca7871"]]},{"id":"108e98ba0b993e62","type":"function","z":"d7eda565344d3004","name":"Event (.event, .side)","func":"\nif (msg.payload.state === undefined || \n    msg.payload.state.buttonevent === undefined) {\n    return null;\n}\n\nvar event = msg.payload.state.buttonevent;\nvar side = Math.round(event/1000);\nvar modifier = event - (side * 1000);\n\nif (event % 1000 === 0) {\n    msg.payload.event = \"slide\";\n}\nelse if (event === 7007) {\n    msg.payload.event = \"shake\";\n}\nelse if (event === (side*1000) + side) {\n    msg.payload.event = \"doubletap\";\n}\nelse if (side + modifier === 7) {\n    msg.payload.event = \"180flip\";\n}\nelse if (side != 7 - modifier) {\n    msg.payload.event = \"flip\";\n}\nelse if (event === 7008) {\n    msg.payload.event = \"drop\";\n}\nelse {\n    msg.payload.event = \"unknown (\" + event + \")\";\n}\nmsg.payload.side = side;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":600,"y":600,"wires":[["0b6cf22c9ad0936d"]]},{"id":"da77a5c74f24adf9","type":"debug","z":"d7eda565344d3004","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":610,"y":60,"wires":[]},{"id":"73259f56b6f3c4c5","type":"http request","z":"d7eda565344d3004","name":"Request new API Key from Deconz","method":"POST","ret":"txt","paytoqs":"ignore","url":"http://192.168.1.105:80/api","tls":"","persist":false,"proxy":"","insecureHTTPParser":false,"authType":"","senderr":false,"headers":[],"x":400,"y":1180,"wires":[["a5740cd594ca80b6"]]},{"id":"43d69ce7f8a2f12e","type":"inject","z":"d7eda565344d3004","name":"Headers for API Key","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{ \"devicetype\": \"nodered\" }","payloadType":"str","x":130,"y":1180,"wires":[["73259f56b6f3c4c5"]]},{"id":"a5740cd594ca80b6","type":"json","z":"d7eda565344d3004","name":"","property":"payload","action":"","pretty":false,"x":710,"y":1180,"wires":[["e793bf8cd58a4ec7"]]},{"id":"02ac08c031258933","type":"comment","z":"d7eda565344d3004","name":"http://dresden-elektronik.github.io/deconz-rest-doc/getting_started/","info":"","x":280,"y":1220,"wires":[]},{"id":"6d05daece7aa707a","type":"http request","z":"d7eda565344d3004","name":"Get lights","method":"GET","ret":"txt","paytoqs":false,"url":"http://192.168.1.105:80/api/7665109987/lights","tls":"","proxy":"","authType":"","x":480,"y":1380,"wires":[["8e8d04bf1b63e82d"]]},{"id":"25074d2a47161ade","type":"inject","z":"d7eda565344d3004","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":270,"y":1380,"wires":[["6d05daece7aa707a"]]},{"id":"79cf2c1096d82748","type":"debug","z":"d7eda565344d3004","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":840,"y":1380,"wires":[]},{"id":"8e8d04bf1b63e82d","type":"json","z":"d7eda565344d3004","name":"","property":"payload","action":"","pretty":false,"x":680,"y":1380,"wires":[["79cf2c1096d82748"]]},{"id":"fa677a80e757cb61","type":"http request","z":"d7eda565344d3004","name":"Get light 4","method":"GET","ret":"txt","paytoqs":false,"url":"http://192.168.1.105:80/api/7665109987/lights/4","tls":"","proxy":"","authType":"","x":490,"y":1420,"wires":[["8e8d04bf1b63e82d"]]},{"id":"62ac55db81bf4122","type":"inject","z":"d7eda565344d3004","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":270,"y":1420,"wires":[["fa677a80e757cb61"]]},{"id":"cf7f5d8b9ff85fa2","type":"http request","z":"d7eda565344d3004","name":"Put Light 4","method":"PUT","ret":"txt","paytoqs":false,"url":"http://192.168.1.105:80/api/7665109987/lights/5/state","tls":"","proxy":"","authType":"","x":490,"y":1460,"wires":[["8e8d04bf1b63e82d"]]},{"id":"2e4809fd31b3fcc6","type":"inject","z":"d7eda565344d3004","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"LIght OFF","payload":"{\"on\":true,\"bri\":180,\"hue\":43680,\"sat\":255,\"transitiontime\":10}","payloadType":"json","x":250,"y":1460,"wires":[["cf7f5d8b9ff85fa2"]]},{"id":"10af9790a5402fcb","type":"http request","z":"d7eda565344d3004","name":"Get Groups","method":"GET","ret":"txt","paytoqs":false,"url":"http://192.168.1.105:80/api/7665109987/groups","tls":"","proxy":"","authType":"","x":470,"y":1520,"wires":[["8e8d04bf1b63e82d"]]},{"id":"efe7ae7716315546","type":"inject","z":"d7eda565344d3004","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"Groups","payload":"","payloadType":"str","x":280,"y":1520,"wires":[["10af9790a5402fcb"]]},{"id":"084497b745256409","type":"http request","z":"d7eda565344d3004","name":"","method":"PUT","ret":"txt","paytoqs":false,"url":"http://192.168.1.105:80/api/7665109987/groups/2/action","tls":"","proxy":"","authType":"","x":470,"y":1580,"wires":[["8e8d04bf1b63e82d"]]},{"id":"bf6c93091aa82bb7","type":"inject","z":"d7eda565344d3004","name":"Groups - ON","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"on\":true,\"bri\":255,\"transitiontime\":10}","payloadType":"json","x":290,"y":1580,"wires":[["084497b745256409"]]},{"id":"e77c0d90168b33de","type":"inject","z":"d7eda565344d3004","name":"Groups - OFF","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"on\":false,\"bri\":255,\"transitiontime\":10}","payloadType":"json","x":290,"y":1620,"wires":[["084497b745256409"]]},{"id":"ec6c3e0d6dfe8e5d","type":"http request","z":"d7eda565344d3004","name":"Get sensors","method":"GET","ret":"txt","paytoqs":false,"url":"http://192.168.1.105:80/api/7665109987/sensors","tls":"","proxy":"","authType":"","x":490,"y":1280,"wires":[["599c0dfb2027bd4e"]]},{"id":"974bef80f1ace45d","type":"inject","z":"d7eda565344d3004","name":"","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":270,"y":1280,"wires":[["ec6c3e0d6dfe8e5d"]]},{"id":"599c0dfb2027bd4e","type":"json","z":"d7eda565344d3004","name":"","property":"payload","action":"","pretty":false,"x":680,"y":1280,"wires":[["acb7a0f91c24f697"]]},{"id":"a209e73e1513e91c","type":"switch","z":"d7eda565344d3004","name":"Cube2","property":"payload.id","propertyType":"msg","rules":[{"t":"eq","v":"34","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":410,"y":560,"wires":[[]]},{"id":"d8045bda965b53e5","type":"function","z":"d7eda565344d3004","name":"Event (.event, .side)","func":"\nif (msg.payload.state === undefined || \n    msg.payload.state.buttonevent === undefined) {\n    return null;\n}\n\nvar event = msg.payload.state.buttonevent;\nvar side = Math.round(event/1000);\nvar modifier = event - (side * 1000);\n\nif (event % 1000 === 0) {\n    msg.payload.event = \"slide\";\n}\nelse if (event === 7007) {\n    msg.payload.event = \"shake\";\n}\nelse if (event === (side*1000) + side) {\n    msg.payload.event = \"doubletap\";\n}\nelse if (side + modifier === 7) {\n    msg.payload.event = \"180flip\";\n}\nelse if (side != 7 - modifier) {\n    msg.payload.event = \"flip\";\n}\nelse if (event === 7008) {\n    msg.payload.event = \"drop\";\n}\nelse {\n    msg.payload.event = \"unknown (\" + event + \")\";\n}\nmsg.payload.side = side;\nreturn msg;","outputs":1,"noerr":0,"x":600,"y":560,"wires":[["38e273967af09d15"]]},{"id":"38e273967af09d15","type":"mqtt out","z":"d7eda565344d3004","name":"","topic":"/device/cube2/event","qos":"","retain":"","broker":"627df8f806a8df74","x":1020,"y":560,"wires":[]},{"id":"3cc93e1075cf84be","type":"function","z":"d7eda565344d3004","name":"Cave Lights","func":"\nswitch (msg.payload.id)\n{\n    case \"10\":\n    case\"11\":\n    case \"12\":\n        return msg;\n    default:\n        return null;\n}","outputs":1,"noerr":0,"x":310,"y":1060,"wires":[["9ec03dd7350a2a5d"]]},{"id":"9ec03dd7350a2a5d","type":"link out","z":"d7eda565344d3004","name":"Cave LIghts","links":["71c66eac.2ef66"],"x":435,"y":1060,"wires":[]},{"id":"ef43a7d6b0144784","type":"link out","z":"d7eda565344d3004","name":"Button 00:8b:f3","mode":"link","links":[],"x":935,"y":20,"wires":[]},{"id":"0786e36a070d7c03","type":"link out","z":"d7eda565344d3004","name":"Button 05:bf:0b","mode":"link","links":["bae88efd8d18c737"],"x":935,"y":100,"wires":[]},{"id":"ef9caef1814d08b6","type":"link out","z":"d7eda565344d3004","name":"Button 33","links":[],"x":935,"y":140,"wires":[]},{"id":"2935353eedd436be","type":"switch","z":"d7eda565344d3004","name":"Buttons","property":"payload.state.buttonevent","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":320,"y":260,"wires":[["4d3cf0afb967cca4","47a3fab1a50a905c"]]},{"id":"9c654436d7036429","type":"debug","z":"d7eda565344d3004","name":"Otherwise","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":700,"y":360,"wires":[]},{"id":"7d2bab3514a8dfb5","type":"link out","z":"d7eda565344d3004","name":"Button 31","mode":"link","links":[],"x":935,"y":60,"wires":[]},{"id":"4d3cf0afb967cca4","type":"switch","z":"d7eda565344d3004","name":"Button Ids","property":"payload.uniqueid","propertyType":"msg","rules":[{"t":"cont","v":"00:8b:f3","vt":"str"},{"t":"eq","v":"31","vt":"str"},{"t":"cont","v":"05:bf:0b","vt":"str"},{"t":"eq","v":"33","vt":"str"},{"t":"cont","v":"e7:9b:8b","vt":"str"},{"t":"cont","v":"89:d7:0a","vt":"str"},{"t":"cont","v":"9a:77:0c","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":8,"x":540,"y":180,"wires":[["ef43a7d6b0144784"],["7d2bab3514a8dfb5"],["0786e36a070d7c03"],["ef9caef1814d08b6"],["908f31e7b8c1ddd4"],["898cc3fad12c9c7b"],["e93986f662f386c4"],["9c654436d7036429"]]},{"id":"a25943a90d6d2075","type":"switch","z":"d7eda565344d3004","name":"Motion","property":"payload.state.presence","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":330,"y":460,"wires":[["416fa04d89d1d336"]]},{"id":"416fa04d89d1d336","type":"switch","z":"d7eda565344d3004","name":"Motion Ids","property":"payload.id","propertyType":"msg","rules":[{"t":"eq","v":"24","vt":"str"},{"t":"eq","v":"21","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":3,"x":550,"y":460,"wires":[["1faba91e9e2d7cb4"],["c4848be5557cad5e"],["2ed57bf979674f22"]]},{"id":"c4848be5557cad5e","type":"link out","z":"d7eda565344d3004","name":"Motion Cave","mode":"link","links":["62d2b7580c1c77f0"],"x":895,"y":480,"wires":[]},{"id":"9edb78db7e784d02","type":"link out","z":"d7eda565344d3004","name":"Motion Kitchen","mode":"link","links":[],"x":895,"y":440,"wires":[]},{"id":"2ed57bf979674f22","type":"debug","z":"d7eda565344d3004","name":"Otherwise","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":780,"y":500,"wires":[]},{"id":"082fd05af6526f4f","type":"debug","z":"d7eda565344d3004","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1010,"y":1020,"wires":[]},{"id":"e793bf8cd58a4ec7","type":"debug","z":"d7eda565344d3004","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":950,"y":1180,"wires":[]},{"id":"c621336b644b3d17","type":"debug","z":"d7eda565344d3004","name":"Motion","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1070,"y":1280,"wires":[]},{"id":"b4b2e91f.8e4368","type":"inject","z":"d7eda565344d3004","name":"","props":[{"p":"payload"},{"p":"exclude","v":"[[\"melon\"],[\"banana\"]]","vt":"json"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"[{\"altname\":\"melon\"},{\"altname\":\"cherry\"},{\"altname\":\"banana\"}]","payloadType":"json","x":610,"y":1120,"wires":[["3fbdbc18.951c94"]]},{"id":"3fbdbc18.951c94","type":"function","z":"d7eda565344d3004","name":"cycle counter","func":"\n\nmsg.payload = msg.payload.filter(el => !msg.exclude.includes(el.altname));\n\nnode.warn(msg.payload);\nreturn msg;","outputs":1,"timeout":"","noerr":0,"initialize":"","finalize":"","libs":[],"x":770,"y":1120,"wires":[["ab67374c.c64458"]]},{"id":"ab67374c.c64458","type":"debug","z":"d7eda565344d3004","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1000,"y":1100,"wires":[]},{"id":"17a6249a011b213f","type":"function","z":"d7eda565344d3004","name":"Motion","func":"\nmsg.payload = msg.payload.filter(el => el.modelid == \"lumi.sensor_motion.aq2\");\nreturn msg;\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":950,"y":1220,"wires":[["c621336b644b3d17"]]},{"id":"4427e4fdb303c0c8","type":"debug","z":"d7eda565344d3004","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":890,"y":1320,"wires":[]},{"id":"acb7a0f91c24f697","type":"split","z":"d7eda565344d3004","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":790,"y":1240,"wires":[["4427e4fdb303c0c8"]]},{"id":"baa3308fdde5af99","type":"switch","z":"d7eda565344d3004","name":"Temp","property":"payload.state.temperature","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":170,"y":780,"wires":[["c7ec97fd87c82246","8227d94abbd80ea9"]]},{"id":"c7ec97fd87c82246","type":"switch","z":"d7eda565344d3004","name":"Devices","property":"payload.uniqueid","propertyType":"msg","rules":[{"t":"cont","v":"6b:31:e1","vt":"str"},{"t":"cont","v":"40:49:7c","vt":"str"},{"t":"cont","v":"5c:9b:9f","vt":"str"},{"t":"cont","v":"23:2b:69","vt":"str"},{"t":"cont","v":"43:b0:53","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":6,"x":420,"y":780,"wires":[["0b9f7bb39df018ee"],["1b5001cd33fcd68a"],["5688305688495409","c23a8527f3f7ce8a"],["153873e0de32febe","121902841899a9af"],["4fd1a35aaf0180a4","6d193b279c087c07"],["3580a6fcebf70c07"]]},{"id":"0b9f7bb39df018ee","type":"link out","z":"d7eda565344d3004","name":"6b:31:e1","mode":"link","links":["388665cc541b6411"],"x":645,"y":740,"wires":[],"icon":"font-awesome/fa-thermometer-0"},{"id":"908f31e7b8c1ddd4","type":"link out","z":"d7eda565344d3004","name":"Button e7:96:8b","mode":"link","links":[],"x":935,"y":180,"wires":[],"icon":"node-red-dashboard/ui_button.png"},{"id":"c23a8527f3f7ce8a","type":"debug","z":"d7eda565344d3004","name":"Heatpump","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":970,"y":840,"wires":[]},{"id":"f95d794180f2bcc5","type":"json","z":"d7eda565344d3004","name":"","property":"payload","action":"","pretty":false,"x":430,"y":60,"wires":[["da77a5c74f24adf9"]]},{"id":"7fcf85ed2b79915e","type":"link out","z":"d7eda565344d3004","g":"cda9d340ce49a5bf","name":"Cube 89:d7:0a Event","mode":"link","links":["d15733b76b3778fb"],"x":1255,"y":280,"wires":[],"icon":"node-red-dashboard/ui_button.png"},{"id":"e723d6a4da0d1d9a","type":"switch","z":"d7eda565344d3004","name":"Humidity","property":"payload.state.humidity","propertyType":"msg","rules":[{"t":"nnull"}],"checkall":"true","repair":false,"outputs":1,"x":1060,"y":780,"wires":[["121ffcc551d3e1bc"]]},{"id":"121ffcc551d3e1bc","type":"switch","z":"d7eda565344d3004","name":"6b:31:e1","property":"payload.uniqueid","propertyType":"msg","rules":[{"t":"cont","v":"6b:31:e1","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1200,"y":780,"wires":[["3e0d99e8163dd771"],[]]},{"id":"3e0d99e8163dd771","type":"link out","z":"d7eda565344d3004","name":"Humidty 6b:31:e1","mode":"link","links":["7f63e56df1d078e6"],"x":1345,"y":780,"wires":[],"icon":"node-red-contrib-xiaomi-sensors/water-sensor.png"},{"id":"1b5001cd33fcd68a","type":"link out","z":"d7eda565344d3004","name":"Temp 40:49:7c","mode":"link","links":["7d8bb5e5c5533500"],"x":645,"y":780,"wires":[],"icon":"font-awesome/fa-thermometer-0"},{"id":"38bd7272f030c132","type":"debug","z":"d7eda565344d3004","name":"Cube Event","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1290,"y":140,"wires":[]},{"id":"47a3fab1a50a905c","type":"debug","z":"d7eda565344d3004","name":"debug 2","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":520,"y":280,"wires":[]},{"id":"6c585d81f6912a31","type":"link out","z":"d7eda565344d3004","g":"cda9d340ce49a5bf","name":"Cube 9a:77:0c Event","mode":"link","links":["fd8b443ae4f19bd6"],"x":1255,"y":320,"wires":[],"icon":"node-red-dashboard/ui_button.png"},{"id":"898cc3fad12c9c7b","type":"function","z":"d7eda565344d3004","g":"cda9d340ce49a5bf","name":"Cube Event Parser","func":"if (msg.payload.state === undefined || \n    msg.payload.state.buttonevent === undefined) {\n    return null;\n}\nvar event = msg.payload.state.buttonevent;\n\nvar side = Math.round(event/1000);\n\nvar modifier = event - (side * 1000);\n\nif (event % 1000 === 0) {\n    msg.event = \"slide\";\n}\nelse if (event === 7007) {\n    msg.event = \"shake\";\n}\nelse if (event === (side*1000) + side) {\n    msg.event = \"doubletap\";\n}\nelse if (side + modifier === 7) {\n    msg.event = \"180flip\";\n}\nelse if (side != 7 - modifier) {\n    msg.event = \"flip\";\n}\nelse if (event === 7008) {\n    msg.event = \"drop\";\n}\nelse {\n    msg.event = \"unknown (\" + event + \")\";\n}\nmsg.side = side;\n\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":990,"y":280,"wires":[["7fcf85ed2b79915e","38bd7272f030c132"]]},{"id":"e93986f662f386c4","type":"function","z":"d7eda565344d3004","g":"cda9d340ce49a5bf","name":"Cube Event Parser","func":"if (msg.payload.state === undefined || \n    msg.payload.state.buttonevent === undefined) {\n    return null;\n}\nvar event = msg.payload.state.buttonevent;\n\nvar side = Math.round(event/1000);\n\nvar modifier = event - (side * 1000);\n\nif (event % 1000 === 0) {\n    msg.event = \"slide\";\n}\nelse if (event === 7007) {\n    msg.event = \"shake\";\n}\nelse if (event === (side*1000) + side) {\n    msg.event = \"doubletap\";\n}\nelse if (side + modifier === 7) {\n    msg.event = \"180flip\";\n}\nelse if (side != 7 - modifier) {\n    msg.event = \"flip\";\n}\nelse if (event === 7008) {\n    msg.event = \"drop\";\n}\nelse {\n    msg.event = \"unknown (\" + event + \")\";\n}\nmsg.side = side;\n\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":990,"y":320,"wires":[["6c585d81f6912a31"]]},{"id":"8227d94abbd80ea9","type":"debug","z":"d7eda565344d3004","name":"All temp","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":340,"y":840,"wires":[]},{"id":"aaab41d3f32d090d","type":"function","z":"d7eda565344d3004","name":"function 1","func":"\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":780,"y":640,"wires":[[]]},{"id":"3580a6fcebf70c07","type":"debug","z":"d7eda565344d3004","name":"Otherwise","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":600,"y":900,"wires":[]},{"id":"153873e0de32febe","type":"debug","z":"d7eda565344d3004","name":"Outside","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":960,"y":880,"wires":[]},{"id":"5688305688495409","type":"link out","z":"d7eda565344d3004","name":"Heatpump Temp","mode":"link","links":["8dea5a986529c4ff"],"x":875,"y":840,"wires":[],"icon":"font-awesome/fa-thermometer-0"},{"id":"121902841899a9af","type":"link out","z":"d7eda565344d3004","name":"Outside Temp","mode":"link","links":["a39377a4dc58c568","a09c3ccaf542fa56"],"x":875,"y":880,"wires":[],"icon":"font-awesome/fa-thermometer-0"},{"id":"6d193b279c087c07","type":"debug","z":"d7eda565344d3004","name":"Workshop","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":960,"y":920,"wires":[]},{"id":"4fd1a35aaf0180a4","type":"link out","z":"d7eda565344d3004","name":"Workshop Temp","mode":"link","links":[],"x":875,"y":920,"wires":[],"icon":"font-awesome/fa-thermometer-0"},{"id":"8301f731fc67d7ea","type":"mqtt in","z":"e8fabf2a01eed782","name":"","topic":"/device/atari-stick/BUTTON_DOWN/event","qos":"2","datatype":"auto","broker":"627df8f806a8df74","inputs":0,"x":220,"y":840,"wires":[[]]},{"id":"13b120887cfe9f5c","type":"mqtt in","z":"e8fabf2a01eed782","name":"","topic":"/device/atari-stick/BUTTON_LEFT/event","qos":"2","datatype":"auto","broker":"627df8f806a8df74","inputs":0,"x":210,"y":880,"wires":[[]]},{"id":"11f7e34e442edb64","type":"mqtt in","z":"e8fabf2a01eed782","name":"","topic":"/device/atari-stick/BUTTON_RIGHT/event","qos":"2","datatype":"auto","broker":"627df8f806a8df74","inputs":0,"x":220,"y":800,"wires":[[]]},{"id":"26b032c0764f8e13","type":"mqtt in","z":"e8fabf2a01eed782","name":"","topic":"/device/atari-stick/BUTTON_FIRE/event","qos":"2","datatype":"auto","broker":"627df8f806a8df74","inputs":0,"x":210,"y":720,"wires":[[]]},{"id":"9673320c01421803","type":"mqtt in","z":"e8fabf2a01eed782","name":"","topic":"/device/atari-stick/online","qos":"2","datatype":"auto","broker":"627df8f806a8df74","inputs":0,"x":160,"y":680,"wires":[["e692381b6a1a1e90"]]},{"id":"e692381b6a1a1e90","type":"debug","z":"e8fabf2a01eed782","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":690,"y":680,"wires":[]},{"id":"4860ff006c0aa97f","type":"mqtt in","z":"e8fabf2a01eed782","name":"","topic":"/device/atari-stick/BUTTON_UP/event","qos":"2","datatype":"auto","broker":"627df8f806a8df74","inputs":0,"x":310,"y":320,"wires":[["b53284aac4f58692"]]},{"id":"f55257be996ca7fa","type":"debug","z":"e8fabf2a01eed782","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1050,"y":100,"wires":[]},{"id":"130f32ea51d08b0d","type":"mqtt out","z":"e8fabf2a01eed782","name":"","topic":"/device/smartsocket/SMTSKT05/command","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"627df8f806a8df74","x":1130,"y":220,"wires":[]},{"id":"8696ab6c63c08522","type":"mqtt in","z":"e8fabf2a01eed782","name":"","topic":"/device/smartsocket/SMTSKT05/event","qos":"2","datatype":"auto","broker":"627df8f806a8df74","nl":false,"rap":true,"rh":0,"inputs":0,"x":310,"y":180,"wires":[["d09f9282eff1f428"]]},{"id":"d09f9282eff1f428","type":"subflow:0c4a1aef5ced3d40","z":"e8fabf2a01eed782","name":"PC Top LIght","env":[{"name":"event_name","value":"ATARI_JOYSTICK_UP","type":"str"},{"name":"variation","value":"infinte","type":"str"},{"name":"timeout_seconds","value":"0","type":"num"}],"x":610,"y":220,"wires":[["f55257be996ca7fa","130f32ea51d08b0d"]]},{"id":"7e62d33c3f298e20","type":"mqtt in","z":"e8fabf2a01eed782","name":"","topic":"/device/atari-stick/BUTTON_LEFT/event","qos":"2","datatype":"auto","broker":"627df8f806a8df74","inputs":0,"x":310,"y":220,"wires":[["d09f9282eff1f428"]]},{"id":"79d40dacc05a164e","type":"mqtt in","z":"e8fabf2a01eed782","name":"","topic":"/device/smartsocket/SMTSKT02/event","qos":"2","datatype":"auto","broker":"627df8f806a8df74","nl":false,"rap":true,"rh":0,"inputs":0,"x":310,"y":280,"wires":[["b53284aac4f58692"]]},{"id":"b53284aac4f58692","type":"subflow:0c4a1aef5ced3d40","z":"e8fabf2a01eed782","name":"PC Monitor Under Light","env":[{"name":"event_name","value":"ATARI_JOYSTICK_UP","type":"str"},{"name":"variation","value":"infinite","type":"str"},{"name":"timeout_seconds","value":"0","type":"num"}],"x":650,"y":280,"wires":[["f7be6df62b02f56d","f55257be996ca7fa"]]},{"id":"f7be6df62b02f56d","type":"mqtt out","z":"e8fabf2a01eed782","name":"","topic":"/device/smartsocket/SMTSKT02/command","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"627df8f806a8df74","x":1130,"y":280,"wires":[]},{"id":"bae88efd8d18c737","type":"link in","z":"e8fabf2a01eed782","name":"Button 05:bf:0b","links":["0786e36a070d7c03"],"x":285,"y":500,"wires":[["53918c71bf58dd53"]],"icon":"node-red-contrib-deconz/icon-color.png"},{"id":"5c18d75352213310","type":"subflow:0c4a1aef5ced3d40","z":"e8fabf2a01eed782","name":"WARDROBE_LIGHT","env":[{"name":"event_name","value":"WARDROBE_LIGHT","type":"str"},{"name":"variation","value":"1 minutes","type":"str"},{"name":"timeout_seconds","value":"60","type":"num"}],"x":640,"y":400,"wires":[["6bccba341b398e07","2d97cea1a47f4114"]]},{"id":"6bccba341b398e07","type":"mqtt out","z":"e8fabf2a01eed782","name":"","topic":"/device/smartsocket/SMTSKT07/command","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"627df8f806a8df74","x":1130,"y":400,"wires":[]},{"id":"c11e85f17a27246e","type":"mqtt out","z":"e8fabf2a01eed782","name":"","topic":"/device/smartsocket/SMTSKT01/command","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"627df8f806a8df74","x":1130,"y":480,"wires":[]},{"id":"3c4ce1236b606d5b","type":"mqtt in","z":"e8fabf2a01eed782","name":"","topic":"/device/atom-lite-1/button","qos":"2","datatype":"auto","broker":"627df8f806a8df74","nl":false,"rap":false,"inputs":0,"x":270,"y":400,"wires":[["5c18d75352213310"]]},{"id":"53918c71bf58dd53","type":"subflow:0c4a1aef5ced3d40","z":"e8fabf2a01eed782","name":"WORKBENCH_LIGHT","env":[{"name":"event_name","value":"WORKBENCH_LIGHT","type":"str"},{"name":"timeout_seconds","value":"0","type":"num"}],"x":640,"y":480,"wires":[["c11e85f17a27246e","b3603e2fdb582b33"]]},{"id":"0eb67fa3eeee89d6","type":"mqtt in","z":"e8fabf2a01eed782","name":"","topic":"/device/atari-stick/BUTTON_UP/event","qos":"2","datatype":"auto","broker":"627df8f806a8df74","inputs":0,"x":210,"y":760,"wires":[[]]},{"id":"62d2b7580c1c77f0","type":"link in","z":"e8fabf2a01eed782","name":"Motion Cave","links":["c4848be5557cad5e"],"x":285,"y":460,"wires":[["5c18d75352213310","03c5faa7aee95391"]],"icon":"node-red-contrib-deconz/icon-color.png"},{"id":"e7f942cd80b4cc95","type":"mqtt in","z":"e8fabf2a01eed782","name":"","topic":"/device/smartsocket/SMTSKT07/online","qos":"2","datatype":"auto","broker":"627df8f806a8df74","nl":false,"rap":true,"rh":0,"inputs":0,"x":210,"y":940,"wires":[["e25fdbb39a4354c4"]]},{"id":"e25fdbb39a4354c4","type":"trigger","z":"e8fabf2a01eed782","name":"","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"500","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":480,"y":940,"wires":[[]]},{"id":"03c5faa7aee95391","type":"debug","z":"e8fabf2a01eed782","name":"From Sensor","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":590,"y":560,"wires":[]},{"id":"2d97cea1a47f4114","type":"debug","z":"e8fabf2a01eed782","name":"Subflow output","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":920,"y":540,"wires":[]},{"id":"30b9472f661be47b","type":"inject","z":"e8fabf2a01eed782","name":"Motion","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"state\":{\"presence\":\"motion\"}}","payloadType":"json","x":550,"y":340,"wires":[["5c18d75352213310"]]},{"id":"3d705e9cd0ed12b6","type":"mqtt in","z":"e8fabf2a01eed782","name":"","topic":"/device/smartsocket/SMTSKT03/online","qos":"2","datatype":"auto","broker":"627df8f806a8df74","nl":false,"rap":true,"rh":0,"inputs":0,"x":210,"y":1000,"wires":[["78bc5b31a245b06e"]]},{"id":"78bc5b31a245b06e","type":"trigger","z":"e8fabf2a01eed782","name":"","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"500","extend":false,"overrideDelay":false,"units":"ms","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":480,"y":1000,"wires":[[]]},{"id":"b3603e2fdb582b33","type":"debug","z":"e8fabf2a01eed782","name":"debug 3","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":880,"y":440,"wires":[]},{"id":"9271d47b165c8189","type":"mqtt out","z":"df36b737c8742674","name":"","topic":"/dev/timestamp","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"627df8f806a8df74","x":500,"y":80,"wires":[]},{"id":"7fe84abca9a6da5f","type":"inject","z":"df36b737c8742674","name":"1 Second","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"1","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":80,"wires":[["9271d47b165c8189"]]},{"id":"4399d6c63fda7166","type":"mqtt out","z":"df36b737c8742674","name":"/nodered/time10s","topic":"/nodered/time10s","qos":"","retain":"","broker":"627df8f806a8df74","x":510,"y":220,"wires":[]},{"id":"891cbf932779bf35","type":"inject","z":"df36b737c8742674","name":"10 Second","repeat":"10","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":150,"y":220,"wires":[["4399d6c63fda7166","4aed34d3c2dbc76c"]]},{"id":"4aed34d3c2dbc76c","type":"link out","z":"df36b737c8742674","name":"10 Seconds","mode":"link","links":["c9401763b1caa31b"],"x":435,"y":280,"wires":[]},{"id":"7d2494729cf24dd0","type":"mqtt in","z":"f7d3139e6c4a4f09","name":"","topic":"/kitchen/bench-lights/online","qos":"2","datatype":"auto","broker":"627df8f806a8df74","inputs":0,"x":160,"y":400,"wires":[["f8ceca7ed8bea225"]]},{"id":"f8ceca7ed8bea225","type":"trigger","z":"f7d3139e6c4a4f09","name":"Online","op1":"1","op2":"0","op1type":"str","op2type":"str","duration":"1000","extend":false,"units":"ms","reset":"","bytopic":"all","outputs":1,"x":450,"y":400,"wires":[[]]},{"id":"9d3c57922cd20449","type":"mqtt in","z":"f7d3139e6c4a4f09","name":"","topic":"/device/aqara/motion/kitchen","qos":"2","datatype":"auto","broker":"627df8f806a8df74","nl":false,"rap":false,"inputs":0,"x":160,"y":520,"wires":[["72574cd4bb561358"]]},{"id":"72574cd4bb561358","type":"trigger","z":"f7d3139e6c4a4f09","name":"","op1":"$LED_ALL$ON","op2":"$LED_ALL$OFF","op1type":"str","op2type":"str","duration":"5","extend":true,"overrideDelay":false,"units":"min","reset":"","bytopic":"all","topic":"topic","outputs":1,"x":420,"y":520,"wires":[["cc9d3f09888daf6e","d8412a0f361f68ff"]]},{"id":"d8412a0f361f68ff","type":"debug","z":"f7d3139e6c4a4f09","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":650,"y":440,"wires":[]},{"id":"cc9d3f09888daf6e","type":"mqtt out","z":"f7d3139e6c4a4f09","name":"","topic":"/kitchen/bench-lights/command","qos":"","retain":"","broker":"627df8f806a8df74","x":1170,"y":520,"wires":[]},{"id":"0aa54dfab71a0e4f","type":"inject","z":"f7d3139e6c4a4f09","name":"$LED_ALL$OFF","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"$LED_ALL$OFF","payloadType":"str","x":900,"y":440,"wires":[["cc9d3f09888daf6e"]]},{"id":"afd14491b97b10e4","type":"inject","z":"f7d3139e6c4a4f09","name":"$LED_ALL$ON","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"$LED_ALL$ON","payloadType":"str","x":900,"y":400,"wires":[["cc9d3f09888daf6e"]]},{"id":"aa94004bd41fa7e5","type":"inject","z":"f7d3139e6c4a4f09","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"/kitchen/bench-lights/command\"","payload":"$LEDS$ON","payloadType":"str","x":190,"y":280,"wires":[["39dfed63017acbfd"]]},{"id":"39dfed63017acbfd","type":"mqtt out","z":"f7d3139e6c4a4f09","name":"","topic":"/kitchen/bench-lights/command","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"627df8f806a8df74","x":670,"y":300,"wires":[]},{"id":"a3c0b6d651ad3919","type":"inject","z":"f7d3139e6c4a4f09","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"/kitchen/bench-lights/command\"","payload":"$WIDGET$1$RED","payloadType":"str","x":370,"y":180,"wires":[["39dfed63017acbfd"]]},{"id":"43148b60dc5b3bac","type":"inject","z":"f7d3139e6c4a4f09","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"/kitchen/bench-lights/command\"","payload":"$WIDGET$1$GREEN","payloadType":"str","x":380,"y":220,"wires":[["39dfed63017acbfd"]]},{"id":"3afdd1cce707d8fe","type":"inject","z":"f7d3139e6c4a4f09","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"/kitchen/bench-lights/command\"","payload":"$WIDGET$1$OFF","payloadType":"str","x":370,"y":140,"wires":[["39dfed63017acbfd"]]},{"id":"4a05f5f863b65a18","type":"inject","z":"f7d3139e6c4a4f09","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"/kitchen/bench-lights/command\"","payload":"$LEDS$OFF","payloadType":"str","x":190,"y":240,"wires":[["39dfed63017acbfd"]]},{"id":"39ab3ad5285eb0a6","type":"inject","z":"f7d3139e6c4a4f09","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"/kitchen/bench-lights/command\"","payload":"$FLASH$1$RED","payloadType":"str","x":580,"y":100,"wires":[["39dfed63017acbfd"]]},{"id":"3dd9d5f078cf659f","type":"inject","z":"f7d3139e6c4a4f09","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"/kitchen/bench-lights/command\"","payload":"$FLASH$0$GREEN","payloadType":"str","x":690,"y":40,"wires":[["39dfed63017acbfd"]]},{"id":"d959b43c152e2262","type":"inject","z":"f7d3139e6c4a4f09","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"/kitchen/bench-lights/command\"","payload":"$WIDGET$0$OFF","payloadType":"str","x":330,"y":40,"wires":[["39dfed63017acbfd"]]},{"id":"10b147fc279452c3","type":"inject","z":"f7d3139e6c4a4f09","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"/kitchen/bench-lights/command\"","payload":"$WIDGET$0$RED","payloadType":"str","x":330,"y":80,"wires":[["39dfed63017acbfd"]]},{"id":"b73d570d4acb2b05","type":"http request","z":"51491686703cf8dc","name":"Light above me State (1)","method":"PUT","ret":"obj","paytoqs":false,"url":"http://192.168.1.105:80/api/7665109987/lights/1/state","tls":"","proxy":"","authType":"","x":570,"y":60,"wires":[[]]},{"id":"18d73538de72aee7","type":"http request","z":"51491686703cf8dc","name":"Light 2 State","method":"PUT","ret":"obj","paytoqs":false,"url":"http://192.168.1.105:80/api/7665109987/lights/2/state","tls":"","proxy":"","authType":"","x":530,"y":120,"wires":[[]]},{"id":"9057608d02b4ba19","type":"http request","z":"51491686703cf8dc","name":"Light 3 State","method":"PUT","ret":"obj","paytoqs":false,"url":"http://192.168.1.105:80/api/7665109987/lights/3/state","tls":"","proxy":"","authType":"","x":530,"y":180,"wires":[[]]},{"id":"8208624d44807169","type":"inject","z":"51491686703cf8dc","name":"OFF","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"on\":false,\"bri\":255,\"hue\":43680,\"sat\":255,\"transitiontime\":10}","payloadType":"json","x":90,"y":40,"wires":[["d0a7e761d8969fe8"]]},{"id":"7d6d72f49e1bfc68","type":"http request","z":"51491686703cf8dc","name":"Light 7 State","method":"PUT","ret":"obj","paytoqs":false,"url":"http://192.168.1.105:80/api/7665109987/lights/7/state","tls":"","proxy":"","authType":"","x":530,"y":240,"wires":[[]]},{"id":"2a6a4a5f7b444072","type":"http request","z":"51491686703cf8dc","name":"Light above Leila 8 State","method":"PUT","ret":"obj","paytoqs":false,"url":"http://192.168.1.105:80/api/7665109987/lights/8/state","tls":"","proxy":"","authType":"","x":570,"y":300,"wires":[[]]},{"id":"f7ff0362f22addf5","type":"mqtt in","z":"51491686703cf8dc","name":"","topic":"/device/aqara/lounge-button/doubletap","qos":"2","datatype":"auto","broker":"627df8f806a8df74","inputs":0,"x":170,"y":420,"wires":[[]]},{"id":"c480728c0b043a51","type":"mqtt in","z":"51491686703cf8dc","name":"","topic":"/device/aqara/lounge-button/tripletap","qos":"2","datatype":"auto","broker":"627df8f806a8df74","inputs":0,"x":170,"y":460,"wires":[[]]},{"id":"fc49fb88a3ef4432","type":"mqtt in","z":"51491686703cf8dc","name":"","topic":"/device/aqara/lounge-button/quadtap","qos":"2","datatype":"auto","broker":"627df8f806a8df74","inputs":0,"x":170,"y":500,"wires":[[]]},{"id":"1d8452374e84891c","type":"mqtt in","z":"51491686703cf8dc","name":"/device/cube1/event","topic":"/device/cube1/event","qos":"2","datatype":"json","broker":"627df8f806a8df74","inputs":0,"x":830,"y":40,"wires":[["b6744533af6a7068"]]},{"id":"b98748ef81b181b2","type":"mqtt in","z":"51491686703cf8dc","name":"","topic":"/device/motion/door/event","qos":"2","datatype":"json","broker":"627df8f806a8df74","inputs":0,"x":130,"y":760,"wires":[[]]},{"id":"587bbb99d1c9ba8c","type":"inject","z":"51491686703cf8dc","name":"Initialise","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":520,"y":540,"wires":[[]]},{"id":"b6744533af6a7068","type":"function","z":"51491686703cf8dc","name":"shake","func":"if (msg.payload.event !== \"shake\") {\n    return null;\n}\nreturn msg;","outputs":1,"noerr":0,"x":1010,"y":40,"wires":[["1fd0729b6fde9dc6","142c0b60375b4fcd"]]},{"id":"1fd0729b6fde9dc6","type":"delay","z":"51491686703cf8dc","name":"","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"outputs":1,"x":1020,"y":120,"wires":[["e1ef7fe6c233c2d6"]]},{"id":"828eca503914589f","type":"http request","z":"51491686703cf8dc","name":"Light above me State (1)","method":"PUT","ret":"obj","paytoqs":false,"url":"http://192.168.1.105:80/api/7665109987/lights/1/state","tls":"","proxy":"","authType":"","x":1410,"y":40,"wires":[[]]},{"id":"a3e3753776a13ed1","type":"http request","z":"51491686703cf8dc","name":"Light 2 State","method":"PUT","ret":"obj","paytoqs":false,"url":"http://192.168.1.105:80/api/7665109987/lights/2/state","tls":"","proxy":"","authType":"","x":1370,"y":100,"wires":[[]]},{"id":"40f626b9200a4a6a","type":"http request","z":"51491686703cf8dc","name":"Light 3 State","method":"PUT","ret":"obj","paytoqs":false,"url":"http://192.168.1.105:80/api/7665109987/lights/3/state","tls":"","proxy":"","authType":"","x":1370,"y":160,"wires":[[]]},{"id":"374593267b93df68","type":"http request","z":"51491686703cf8dc","name":"Light 7 State","method":"PUT","ret":"obj","paytoqs":false,"url":"http://192.168.1.105:80/api/7665109987/lights/7/state","tls":"","proxy":"","authType":"","x":1370,"y":220,"wires":[[]]},{"id":"b397f7bb4e17cb41","type":"http request","z":"51491686703cf8dc","name":"Light above Leila 8 State","method":"PUT","ret":"obj","paytoqs":false,"url":"http://192.168.1.105:80/api/7665109987/lights/8/state","tls":"","proxy":"","authType":"","x":1410,"y":280,"wires":[[]]},{"id":"e1ef7fe6c233c2d6","type":"function","z":"51491686703cf8dc","name":"ON","func":"msg.payload = \"{\\\"on\\\":true,\\\"bri\\\":255,\\\"hue\\\":43680,\\\"sat\\\":255,\\\"transitiontime\\\":10}\";\nreturn msg;","outputs":1,"noerr":0,"x":1170,"y":240,"wires":[["b397f7bb4e17cb41","374593267b93df68"]]},{"id":"142c0b60375b4fcd","type":"function","z":"51491686703cf8dc","name":"OFF","func":"msg.payload = \"{\\\"on\\\":false,\\\"bri\\\":255,\\\"hue\\\":43680,\\\"sat\\\":255,\\\"transitiontime\\\":10}\";\nreturn msg;","outputs":1,"noerr":0,"x":1170,"y":40,"wires":[["828eca503914589f","a3e3753776a13ed1","40f626b9200a4a6a","374593267b93df68","b397f7bb4e17cb41"]]},{"id":"8832d3dde597c341","type":"ui_button","z":"51491686703cf8dc","name":"","group":"cb532fdebf14059e","order":2,"width":"3","height":"3","passthru":false,"label":"OFF","tooltip":"","color":"black","bgcolor":"lightgrey","icon":"","payload":"{\"on\":false,\"bri\":255,\"hue\":43680,\"sat\":255,\"transitiontime\":10}","payloadType":"json","topic":"","x":330,"y":60,"wires":[["b73d570d4acb2b05","18d73538de72aee7","9057608d02b4ba19","2a6a4a5f7b444072"]]},{"id":"4f340dfee13fe796","type":"ui_button","z":"51491686703cf8dc","name":"","group":"cb532fdebf14059e","order":1,"width":"3","height":"3","passthru":false,"label":"ON","tooltip":"","color":"","bgcolor":"green","icon":"","payload":"{\"on\":true,\"bri\":255,\"hue\":43680,\"sat\":255,\"transitiontime\":10}","payloadType":"json","topic":"","x":330,"y":100,"wires":[["b73d570d4acb2b05","18d73538de72aee7","9057608d02b4ba19","7d6d72f49e1bfc68"]]},{"id":"fd8b443ae4f19bd6","type":"link in","z":"51491686703cf8dc","name":"link in 1","links":["6c585d81f6912a31"],"x":55,"y":160,"wires":[["d0a7e761d8969fe8"]]},{"id":"d0a7e761d8969fe8","type":"change","z":"51491686703cf8dc","name":"OFF command","rules":[{"t":"set","p":"payload","pt":"msg","to":"{\"on\":false,\"bri\":255,\"hue\":43680,\"sat\":255,\"transitiontime\":10}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":160,"y":100,"wires":[["8832d3dde597c341"]]},{"id":"a8930600074b7869","type":"ui_gauge","z":"e843e6ebd1213758","name":"","group":"2f0002313b6e6042","order":2,"width":"6","height":"4","gtype":"gage","title":"Bedroom","label":"deg C","format":"{{msg.temperature}}","min":0,"max":"35","colors":["#00b500","#e6e600","#ca3838"],"seg1":"20","seg2":"25","x":1300,"y":320,"wires":[]},{"id":"388665cc541b6411","type":"link in","z":"e843e6ebd1213758","name":"6b:31:e1","links":["0b9f7bb39df018ee"],"x":455,"y":320,"wires":[["73aac0abbb64d328"]],"icon":"font-awesome/fa-thermometer-0"},{"id":"73aac0abbb64d328","type":"function","z":"e843e6ebd1213758","name":"Format","func":"msg.temperature = msg.payload.state.temperature / 100;\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":680,"y":320,"wires":[["a8930600074b7869","230cc4f6e18eec78","41931d0b93195db1","3935de38de30bb29"]]},{"id":"d15733b76b3778fb","type":"link in","z":"e843e6ebd1213758","g":"e80b953f1a14d2de","name":"Button 00:8b:f3","links":["7fcf85ed2b79915e"],"x":455,"y":160,"wires":[["03ed68b181f0d091"]],"icon":"node-red-dashboard/ui_button.png"},{"id":"b473861c92bd5f10","type":"mqtt out","z":"e843e6ebd1213758","g":"e80b953f1a14d2de","name":"","topic":"/device/smartsocket/SMTSKT03/command","qos":"","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"627df8f806a8df74","x":1210,"y":160,"wires":[]},{"id":"a37aeae2b9ee3068","type":"subflow:0c4a1aef5ced3d40","z":"e843e6ebd1213758","g":"e80b953f1a14d2de","name":"BEDROOM_FAN","env":[{"name":"event_name","value":"WORKBENCH_LIGHT","type":"str"},{"name":"variation","value":"infinte","type":"str"},{"name":"timeout_seconds","value":"0","type":"num"}],"x":910,"y":160,"wires":[["b473861c92bd5f10"]]},{"id":"7f63e56df1d078e6","type":"link in","z":"e843e6ebd1213758","name":"Humidity 6b:31:e1","links":["3e0d99e8163dd771"],"x":455,"y":360,"wires":[["7f8cde5d7cc3159e"]],"icon":"node-red-contrib-xiaomi-sensors/water-sensor.png"},{"id":"488cf4992e2ab473","type":"ui_text","z":"e843e6ebd1213758","group":"2f0002313b6e6042","order":1,"width":"3","height":"2","name":"","label":"Humidity","format":"{{msg.humidity}}","layout":"row-spread","x":1300,"y":360,"wires":[]},{"id":"7f8cde5d7cc3159e","type":"function","z":"e843e6ebd1213758","name":"Format","func":"msg.humidity = msg.payload.state.humidity / 100;\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":680,"y":360,"wires":[["488cf4992e2ab473"]]},{"id":"f3a488a10df14177","type":"ui_gauge","z":"e843e6ebd1213758","g":"358a9b518d2b53b9","name":"","group":"95141f0ee55e0d3e","order":1,"width":"6","height":"4","gtype":"gage","title":"Lounge","label":"deg C","format":"{{msg.temperature}}","min":0,"max":"35","colors":["#00b500","#e6e600","#ca3838"],"seg1":"20","seg2":"25","x":960,"y":480,"wires":[]},{"id":"7d8bb5e5c5533500","type":"link in","z":"e843e6ebd1213758","g":"358a9b518d2b53b9","name":"40:49:7c","links":["1b5001cd33fcd68a"],"x":455,"y":480,"wires":[["2396beb836cddc6f"]],"icon":"font-awesome/fa-thermometer-0"},{"id":"2396beb836cddc6f","type":"function","z":"e843e6ebd1213758","g":"358a9b518d2b53b9","name":"Format Temp","func":"\nmsg.temperature = msg.payload.state.temperature / 100;\n// msg.lastupdated = new Date(msg.payload.state.lastupdated);\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":690,"y":480,"wires":[["f3a488a10df14177","7946d3da9852fcc2","baee0946b13e1f01"]]},{"id":"03ed68b181f0d091","type":"switch","z":"e843e6ebd1213758","g":"e80b953f1a14d2de","name":"shake","property":"event","propertyType":"msg","rules":[{"t":"eq","v":"shake","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":570,"y":160,"wires":[["1d51ae3ced88d779","0e76c9f0ce26c6e6"]]},{"id":"1d51ae3ced88d779","type":"function","z":"e843e6ebd1213758","g":"e80b953f1a14d2de","name":"To ON","func":"msg.payload = \"on\";\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":710,"y":160,"wires":[["a37aeae2b9ee3068"]]},{"id":"0e76c9f0ce26c6e6","type":"debug","z":"e843e6ebd1213758","g":"e80b953f1a14d2de","name":"debug 1","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":720,"y":80,"wires":[]},{"id":"25cdd750267b89b0","type":"ui_chart","z":"e843e6ebd1213758","name":"","group":"2f0002313b6e6042","order":3,"width":"0","height":"0","label":"","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"10","ymax":"35","removeOlder":"12","removeOlderPoints":"1000","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":1290,"y":400,"wires":[[]]},{"id":"230cc4f6e18eec78","type":"debug","z":"e843e6ebd1213758","name":"Format output","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":860,"y":260,"wires":[]},{"id":"5566c72979b13661","type":"ui_text","z":"e843e6ebd1213758","group":"2f0002313b6e6042","order":4,"width":"0","height":"0","name":"","label":"Last","format":"{{msg.sincelast}}","layout":"row-spread","x":1290,"y":280,"wires":[]},{"id":"8dea5a986529c4ff","type":"link in","z":"e843e6ebd1213758","name":"Heatpump Temp","links":["5688305688495409"],"x":455,"y":860,"wires":[["5caa00053a7a1ad4"]],"icon":"font-awesome/fa-thermometer-0"},{"id":"7f4dd7a1cccfa4e9","type":"ui_gauge","z":"e843e6ebd1213758","g":"2f5d97db8e632bd6","name":"","group":"c55d435f77e60733","order":2,"width":"6","height":"4","gtype":"gage","title":"Outside","label":"deg C","format":"{{msg.temperature}}","min":0,"max":"35","colors":["#00b500","#e6e600","#ca3838"],"seg1":"20","seg2":"25","x":960,"y":700,"wires":[]},{"id":"1af66367dce8e76c","type":"function","z":"e843e6ebd1213758","g":"2f5d97db8e632bd6","name":"Format Temp","func":"Date.prototype.addHours = function(h) {\n    this.setTime(this.getTime() + (h*60*60*1000));\n    return this;\n}\n\nconst timezoneOffset = 13;\n\nmsg.temperature = msg.payload.state.temperature / 100;\nmsg.lastupdated = new Date(msg.payload.state.lastupdated);\nmsg.offset = msg.lastupdated.addHours(timezoneOffset);\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":690,"y":700,"wires":[["7f4dd7a1cccfa4e9","7ca4416498fe6d73","bfb9378b444b06ab"]]},{"id":"a39377a4dc58c568","type":"link in","z":"e843e6ebd1213758","g":"2f5d97db8e632bd6","name":"Outside Temp","links":["121902841899a9af"],"x":455,"y":700,"wires":[["1af66367dce8e76c"]],"icon":"font-awesome/fa-thermometer-0"},{"id":"afa75b6e71f3a4d1","type":"ui_gauge","z":"e843e6ebd1213758","name":"","group":"95141f0ee55e0d3e","order":3,"width":"6","height":"4","gtype":"gage","title":"Heatpump","label":"deg C","format":"{{msg.temperature}}","min":0,"max":"35","colors":["#00b500","#e6e600","#ca3838"],"seg1":"20","seg2":"25","x":970,"y":860,"wires":[]},{"id":"5caa00053a7a1ad4","type":"function","z":"e843e6ebd1213758","name":"Format Temp","func":"\nmsg.temperature = msg.payload.state.temperature / 100;\nmsg.lastupdated = new Date(msg.payload.state.lastupdated);\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":690,"y":860,"wires":[["afa75b6e71f3a4d1","90c4342897b109cf"]]},{"id":"c9401763b1caa31b","type":"link in","z":"e843e6ebd1213758","name":"link in 2","links":["4aed34d3c2dbc76c"],"x":1005,"y":260,"wires":[["41931d0b93195db1"]]},{"id":"41931d0b93195db1","type":"subflow:5609c5c8e8bb268b","z":"e843e6ebd1213758","name":"","x":1140,"y":280,"wires":[["5566c72979b13661"]]},{"id":"3935de38de30bb29","type":"function","z":"e843e6ebd1213758","name":"Convert for chart","func":"msg.payload = msg.temperature;\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1130,"y":400,"wires":[["25cdd750267b89b0"]]},{"id":"4419b3c54c10fb8b","type":"ui_chart","z":"e843e6ebd1213758","name":"","group":"95141f0ee55e0d3e","order":4,"width":"0","height":"0","label":"","chartType":"line","legend":"false","xformat":"HH:mm","interpolate":"linear","nodata":"","dot":false,"ymin":"10","ymax":"35","removeOlder":"12","removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":1110,"y":900,"wires":[[]]},{"id":"90c4342897b109cf","type":"function","z":"e843e6ebd1213758","name":"Convert for chart","func":"msg.payload = msg.temperature;\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":950,"y":900,"wires":[["4419b3c54c10fb8b"]]},{"id":"5776e35ad7df827b","type":"ui_gauge","z":"e843e6ebd1213758","name":"","group":"a2d93ff3dc576ecd","order":2,"width":"6","height":"4","gtype":"gage","title":"Workshop","label":"deg C","format":"{{msg.temperature}}","min":0,"max":"35","colors":["#00b500","#e6e600","#ca3838"],"seg1":"20","seg2":"25","x":960,"y":960,"wires":[]},{"id":"209bf8370b6d464a","type":"function","z":"e843e6ebd1213758","name":"Format Temp","func":"\nmsg.temperature = msg.payload.state.temperature / 100;\nmsg.lastupdated = new Date(msg.payload.state.lastupdated);\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":690,"y":960,"wires":[["5776e35ad7df827b"]]},{"id":"a09c3ccaf542fa56","type":"link in","z":"e843e6ebd1213758","name":"Outside Temp","links":["121902841899a9af"],"x":455,"y":960,"wires":[["209bf8370b6d464a"]],"icon":"font-awesome/fa-thermometer-0"},{"id":"d00cfc3717188882","type":"ui_text","z":"e843e6ebd1213758","g":"2f5d97db8e632bd6","group":"c55d435f77e60733","order":1,"width":"3","height":"1","name":"Outside Min","label":"Min","format":"{{msg.min.value}}","layout":"row-spread","x":1130,"y":740,"wires":[]},{"id":"b0db3ef15c136c8d","type":"inject","z":"e843e6ebd1213758","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"e\":\"changed\",\"id\":\"17\",\"r\":\"sensors\",\"state\":{\"lastupdated\":\"2024-01-26T21:29:52\",\"temperature\":1780},\"t\":\"event\",\"uniqueid\":\"00:15:8d:00:03:23:2b:69-01-0402\"}","payloadType":"json","x":210,"y":640,"wires":[["4e98e404d4febe37"]]},{"id":"4e98e404d4febe37","type":"function","z":"e843e6ebd1213758","name":"Random temp","func":"msg.payload.state.temperature = Math.floor(Math.random() * (3500 - 2000 + 1)) + 2000;\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":400,"y":640,"wires":[["1af66367dce8e76c"]]},{"id":"7ca4416498fe6d73","type":"subflow:0e02cff517febd41","z":"e843e6ebd1213758","g":"2f5d97db8e632bd6","name":"Min","x":930,"y":740,"wires":[["d00cfc3717188882"]]},{"id":"d485cc3de8136ecd","type":"ui_text","z":"e843e6ebd1213758","g":"2f5d97db8e632bd6","group":"c55d435f77e60733","order":1,"width":"3","height":"1","name":"Outside Max","label":"Max","format":"{{msg.max.value}}","layout":"row-spread","x":1130,"y":780,"wires":[]},{"id":"bfb9378b444b06ab","type":"subflow:0e02cff517febd41","z":"e843e6ebd1213758","g":"2f5d97db8e632bd6","name":"Max","env":[{"name":"MinOrMax","value":"MAX","type":"str"}],"x":930,"y":780,"wires":[["d485cc3de8136ecd"]]},{"id":"c11a777ce0542960","type":"ui_text","z":"e843e6ebd1213758","g":"358a9b518d2b53b9","group":"95141f0ee55e0d3e","order":1,"width":"3","height":"1","name":"Lounge Min","label":"Min","format":"{{msg.min.value}}","layout":"row-spread","x":1130,"y":520,"wires":[]},{"id":"7946d3da9852fcc2","type":"subflow:0e02cff517febd41","z":"e843e6ebd1213758","g":"358a9b518d2b53b9","name":"Min","x":950,"y":520,"wires":[["c11a777ce0542960"]]},{"id":"6a02542369982caf","type":"ui_text","z":"e843e6ebd1213758","g":"358a9b518d2b53b9","group":"95141f0ee55e0d3e","order":1,"width":"3","height":"1","name":"Lounge Max","label":"Max","format":"{{msg.max.value}}","layout":"row-spread","x":1130,"y":560,"wires":[]},{"id":"baee0946b13e1f01","type":"subflow:0e02cff517febd41","z":"e843e6ebd1213758","g":"358a9b518d2b53b9","name":"Max","env":[{"name":"MinOrMax","value":"MAX","type":"str"}],"x":950,"y":560,"wires":[["6a02542369982caf"]]}]
